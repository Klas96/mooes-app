<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.mooves.app">
    <!-- Permissions for image picker -->
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
    <!-- Android 13+ (API 33+) specific permissions -->
    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
    <uses-permission android:name="android.permission.READ_MEDIA_VIDEO" />
    <!-- Internet permission for API calls -->
    <uses-permission android:name="android.permission.INTERNET" />
    <!-- Notification permission for Android 13+ (API 33+) -->
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
    <!-- Location permissions for GPS functionality -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
    <!-- Google Play Billing permission -->
    <uses-permission android:name="com.android.vending.BILLING" />
    <!-- Health Connect permissions (required for Android 14+) -->
    <!-- These permissions must be declared for Health Connect to discover the app -->
    <!-- See: https://developer.android.com/health-and-fitness/health-connect/get-started -->
    
    <!-- Steps data -->
    <uses-permission android:name="android.permission.health.READ_STEPS"/>
    <uses-permission android:name="android.permission.health.WRITE_STEPS"/>
    
    <!-- Distance data -->
    <uses-permission android:name="android.permission.health.READ_DISTANCE"/>
    <uses-permission android:name="android.permission.health.WRITE_DISTANCE"/>
    
    <!-- Active calories burned -->
    <uses-permission android:name="android.permission.health.READ_ACTIVE_CALORIES_BURNED"/>
    <uses-permission android:name="android.permission.health.WRITE_ACTIVE_CALORIES_BURNED"/>
    
    <!-- Exercise/Workout data -->
    <uses-permission android:name="android.permission.health.READ_EXERCISE"/>
    <uses-permission android:name="android.permission.health.WRITE_EXERCISE"/>
    
    <!-- Heart rate (optional, for future use) -->
    <uses-permission android:name="android.permission.health.READ_HEART_RATE"/>
    
    <!-- Workout sessions -->
    <uses-permission android:name="android.permission.health.READ_WORKOUT"/>
    <uses-permission android:name="android.permission.health.WRITE_WORKOUT"/>
    <!-- Camera feature declaration -->
    <uses-feature android:name="android.hardware.camera" android:required="false" />
    <uses-feature android:name="android.hardware.camera.autofocus" android:required="false" />
    
    <application
        android:label="Mooves"
        android:name="${applicationName}"
        android:icon="@mipmap/ic_launcher"
        android:usesCleartextTraffic="true"
        android:networkSecurityConfig="@xml/network_security_config"
        android:allowBackup="true">
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop"
            android:taskAffinity=""
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize">
            <!-- Specifies an Android theme to apply to this Activity as soon as
                 the Android process has started. This theme is visible to the user
                 while the Flutter UI initializes. After that, this theme continues
                 to determine the Window background behind the Flutter UI. -->
            <meta-data
              android:name="io.flutter.embedding.android.NormalTheme"
              android:resource="@style/NormalTheme"
              />
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
            
            <!-- Deep link for password reset -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                
                <!-- Handles links like: https://mooves.klasholmgren.se/reset-password?token=xxx -->
                <data
                    android:scheme="https"
                    android:host="mooves.klasholmgren.se"
                    android:pathPrefix="/reset-password" />
            </intent-filter>
            
            <!-- Custom scheme for app-to-app deep links -->
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />
                
                <!-- Handles links like: mooves://reset-password?token=xxx -->
                <data
                    android:scheme="mooves"
                    android:host="reset-password" />
            </intent-filter>
        </activity>
        <!-- Don't delete the meta-data below.
             This is used by the Flutter tool to generate GeneratedPluginRegistrant.java -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />
        <!-- Privacy Policy URL for Google Play Store -->
        <meta-data
            android:name="privacy_policy_url"
            android:value="https://klas96.github.io/mooves-policy/privacy-policy.html" />
        <!-- Firebase Cloud Messaging Configuration -->
        <meta-data
            android:name="com.google.firebase.messaging.default_notification_icon"
            android:resource="@mipmap/ic_launcher" />
        <meta-data
            android:name="com.google.firebase.messaging.default_notification_color"
            android:resource="@color/notification_color" />
        
        <!-- Play Billing Library version declaration (required by Google Play) -->
        <!-- This tells Google Play that we're using Play Billing Library 6.1.0, not AIDL -->
        <meta-data
            android:name="com.google.android.play.billingclient.version"
            android:value="6.1.0" />
    </application>
    <!-- Required to query activities that can process text, see:
         https://developer.android.com/training/package-visibility and
         https://developer.android.com/reference/android/content/Intent#ACTION_PROCESS_TEXT.

         In particular, this is used by the Flutter engine in io.flutter.plugin.text.ProcessTextPlugin. -->
    <queries>
        <intent>
            <action android:name="android.intent.action.PROCESS_TEXT"/>
            <data android:mimeType="text/plain"/>
        </intent>
        <!-- Health Connect query - Required for Android 14+ -->
        <!-- This allows the app to query and interact with Health Connect -->
        <!-- On Android 14+, Health Connect is system-integrated -->
        <package android:name="com.google.android.apps.healthdata" />
        
        <!-- Health Connect intent actions -->
        <intent>
            <action android:name="androidx.health.ACTION_SHOW_PERMISSIONS_RATIONALE" />
        </intent>
        <intent>
            <action android:name="android.health.connect.action.SHOW_PERMISSIONS_RATIONALE" />
        </intent>
        <!-- Health Connect permission request intent (Android 14+) -->
        <intent>
            <action android:name="android.health.connect.action.REQUEST_PERMISSIONS" />
        </intent>
    </queries>
</manifest>
